---
import openingSceneFor from "@domain/story/publish/support/openingScene";
import type { PublishedStory } from "@domain/story/publish/types.js";

import PrepareAssets from "./aframe/PrepareAssets.astro";
import PrepareStory from "./aframe/PrepareStory.astro";

type Props = {
  story: PublishedStory;
};

const { story } = Astro.props;

const openingScene = openingSceneFor(story);
---

\<script>

  AFRAME.registerComponent('rotation-reader', {
  init: function () {

    window.addEventListener('click', () => {
      const rotation = this.el.object3D.rotation;
      // const position = this.el.object3D.position;

      console.log('Rotação:', rotation);
      // console.log('Posição:', position);
    });
  }
});

    
</script>

<PrepareStory story={story} />

<a-scene story sound="autoplay: false; positional: false">
  <a-sky src={openingScene.image?.url}></a-sky>

  <a-entity id="fiction" position="0 1 -6" layout="type: line; plane: yz;"
  ></a-entity>

  <a-camera position="0 0 1">
    <a-entity
      position="0 0 -3"
      geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.1"
      material="color: gray; shader: flat"
      cursor="maxDistance: 30"
    >
    </a-entity>
  </a-camera>

  <a-entity laser-controls raycaster="objects: [data-raycastable]"></a-entity>

  <a-entity camera look-controls rotation-reader></a-entity>

  <PrepareAssets story={story} openingScene={openingScene} />
</a-scene>
