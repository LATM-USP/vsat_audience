---
import type {
  PublishedScene,
  PublishedStory,
} from "@domain/story/publish/types";

type Props = {
  story: PublishedStory;
  openingScene: PublishedScene;
};

const { story, openingScene } = Astro.props;
---

{/* @see https://aframe.io/docs/1.7.0/core/asset-management-system.html */}
<a-assets>
  {
    story.scenes
      .filter((scene) => scene.audio)
      .map((scene) => {
        const audioId = `audio-${scene.audio!.id}`;
        if (scene.id === openingScene.id) {
          return (
            <a-sound
              id={audioId}
              src={scene.audio!.url}
              autoplay="true"
              loop="true"
              position="0 0 1"
              positional="true"
              rolloffFactor="20"
              volume="7"
              refDistance="10"
              crossorigin="anonymous"
            />
          );
        }
        return (
          <a-sound id={audioId} src={scene.audio!.url} crossorigin="anonymous" />
        );
      })
  }
  {
    story.scenes
      .filter((scene) => scene.image)
      .map((scene) => (
        <img
          id={`image-${scene.image!.id}`}
          src={scene.image!.url}
          crossorigin="anonymous"
        />
      ))
  }
</a-assets>
